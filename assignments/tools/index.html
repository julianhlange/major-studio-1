<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
	    <!--Bootstrap-->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
	    <!--fonts-->
	    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=PT+Sans" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Libre Franklin" type="text/css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700,900" rel="stylesheet">
    </head>
    
    <style type="text/css">
    
        body {
            font-family: 'Roboto', sans-serif;
        }
        
        #title {
            font-size: 48px;
            font-weight: 700;
            line-height: 0.9em;
            margin: 20px;
        }
        
        .intro { position: absolute; text-align: right; font-weight: 300;}
        #intro1 { top: 24px; left: 640px; width: 520px; }
        #intro2 { top: 44px; left: 660px; width: 500px; }
        #intro3 { top: 64px; left: 680px; width: 480px; }
        #intro4 { top: 84px; left: 700px; width: 460px; }
        #intro5 { top: 104px; left: 720px; width: 440px; }
        
        .fromTo { font-family: 'PT Sans', sans-serif; position: absolute; font-size: 20px; top: 160px; }
        #from { left: 895px; }
        #startYear { left: 950px; }
        #to { left: 1030px; }
        #endYear { left: 1055px; }
        
        #submitButton {
            font-family: 'PT Sans', sans-serif;
            font-size: 20px;
            position: absolute;
            left: 950px; top: 195px; width: 178px; height: 35px;
        }
        
        #source { font-family: 'Roboto', sans-serif; font-weight: 300; font-size: 14px; text-align: left; position: absolute; top: 900px; margin: 20px; }
        
        #init {
            left: 160px;
            top: 50px;
            text-align: left;
            position: absolute;
        }
        
        #plot {
            left: 160px;
            top: 50px;
            text-align: left;
            position: absolute;
        }
        
        .axis-title {
            font-family: "PT Sans";
            font-size: 1.8em;
        }
        
        .inequality {
            font-family: "PT Sans";
            font-size: 14px;
        }
        
        .country {
            font-family: "PT Sans";
            pointer-events: none;
            font-size: 16px;
            font-style: bold;
            position: absolute;
        }
        
        #diamond {
            -webkit-transform: rotate(-45deg);
            /*position: fixed;*/
        }
        
        #key {
            -webkit-transform: rotate(-45deg);
            position: fixed;
        }
        
        .x-axis .y-axis {
            fill: none;
            stroke: rgb(100,100,100);
            font-family: "Libre Franklin";
            font-size: 1em;
            shape-rendering: crispEdges;
        }
        
        .grid line {
          stroke: lightgrey;
          stroke-opacity: 0.3;
          shape-rendering: crispEdges;
        }
        
        .zero-line {
            stroke: grey;
            stroke-opacity: 0.8;
        }

        .ticks {
            stroke: #4292c6;
            stroke-opacity: 0.5;
            stroke-width: 2;
        }
    
        .hover-line {
            stroke: #4292c6;
            stroke-opacity: 0.5;
            stroke-width: 1
        }
        
        .arrow {
            stroke: grey;
        }
        
        .modal {
           position: absolute;
           top: 200px;
           /*right: 20px;*/
           left: 0;
           z-index: 10000;
           overflow: auto;
           overflow-y: auto;
           height: 500px;
}

    </style>
    
    <body>

        <div><h1 id="title">How does inequality<br>change over time?<br></h1></div>
        
        <p class="intro" id="intro1">The Gini coefficient is a measure of inequality. It can change in response</p>
        <p class="intro" id="intro2">to policy decisions, national and international events, and economic</p>
        <p class="intro" id="intro3">factors. This scatter plot displays changes in the coefficient for any</p>
        <p class="intro" id="intro4">two years. Only those countries for which data are available in</p>
        <p class="intro" id="intro5">both selected years will appear on the plot.</p>
        
        <p id="from" class="fromTo">From</p>
        <p id="to" class="fromTo">to</p>

        <p id="source">Data are from the <a href="https://www.wider.unu.edu/project/wiid-world-income-inequality-database" target="_blank">
        UNU-WIDER World Income Inequality Database version 3.4 (WIID3.4)</a>. For each country and year, all available Gini scores were averaged.</p>

    <div id="inputForm">
    <form>
        <div class="input">
        <select id="startYear" class="fromTo">
            <option value="_2016">2016</option><option value="_2015">2015</option><option value="_2014">2014</option><option value="_2013">2013</option>
            <option value="_2012">2012</option><option value="_2011">2011</option><option value="_2010">2010</option><option value="_2009">2009</option>
            <option value="_2008">2008</option><option value="_2007">2007</option><option value="_2006">2006</option><option value="_2005">2005</option>
            <option value="_2004">2004</option><option value="_2003">2003</option><option value="_2002">2002</option><option value="_2001">2001</option>
            <option value="_2000">2000</option><option value="_1999">1999</option><option value="_1998">1998</option><option value="_1997">1997</option>
            <option value="_1996">1996</option><option value="_1995">1995</option><option value="_1994">1994</option><option value="_1993">1993</option>
            <option selected value="_1992">1992</option><option value="_1991">1991</option><option value="_1990">1990</option><option value="_1989">1989</option>
            <option value="_1988">1988</option><option value="_1987">1987</option><option value="_1986">1986</option><option value="_1985">1985</option>
            <option value="_1984">1984</option><option value="_1983">1983</option><option value="_1982">1982</option><option value="_1981">1981</option>
            <option value="_1980">1980</option>
        </select>
    
        <select id="endYear" class="fromTo">
            <option value="_2016">2016</option><option value="_2015">2015</option><option value="_2014">2014</option><option value="_2013">2013</option>
            <option value="_2012">2012</option><option value="_2011">2011</option><option value="_2010">2010</option><option value="_2009">2009</option>
            <option value="_2008">2008</option><option value="_2007">2007</option><option value="_2006">2006</option><option value="_2005">2005</option>
            <option value="_2004">2004</option><option value="_2003">2003</option><option value="_2002">2002</option><option value="_2001">2001</option>
            <option value="_2000">2000</option><option value="_1999">1999</option><option value="_1998">1998</option><option value="_1997">1997</option>
            <option value="_1996">1996</option><option value="_1995">1995</option><option value="_1994">1994</option><option selected value="_1993">1993</option>
            <option value="_1992">1992</option><option value="_1991">1991</option><option value="_1990">1990</option><option value="_1989">1989</option>
            <option value="_1988">1988</option><option value="_1987">1987</option><option value="_1986">1986</option><option value="_1985">1985</option>
            <option value="_1984">1984</option><option value="_1983">1983</option><option value="_1982">1982</option><option value="_1981">1981</option>
            <option value="_1980">1980</option>
        </select>
    <input type="submit" id="submitButton"></input>
    </div>
</form>
</div>
    
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="countryName"></h3>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                </div>
            </div>
        </div>
    </div>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    
    <div id="plot"></div>
    
        <script>
        
        // var svg = d3.select("body").append("svg")
        //         .attr("id", "init")
        //         .attr("width", 800)
        //         .attr("height", 800)
                
        // var rect = svg.append("rect")
        //         .attr("x", 300)
        //         .attr("y", -300)
        //         .attr("width", 600)
        //         .attr("height", 600)
        //         .attr("transform", "rotate(45)")
        //         .style("fill", "black")
        
             $("form").on('submit', function (e) {
                e.preventDefault();
                d3.selectAll("svg").remove();
                // console.log($("#startYear").val());
                // console.log($("#endYear").val());
                var xColumn = $("#endYear").val();
                var yColumn = $("#startYear").val();
                var xYearGini = "Income inequality in " + xColumn.substr(1) + " (Gini)";
                var yYearGini = "Income inequality in " + yColumn.substr(1) + " (Gini)"
                
                var pad = 100;
                var w = 800;
                var h = 800;
                var graphTop = h - pad;
                var radius = 7;
                var minGini = 20;
                var maxGini = 80;
            
                d3.csv("giniDataAfrica.csv", function(error, data) {
                    if (error) throw error;
                    data.forEach(function(d) {
                        d[xColumn] = +d[xColumn];
                        d[yColumn] = +d[yColumn];
                        d["countryName"] = d["countryName"];
                        d["difference"] = d[xColumn] - d[yColumn];
                    });
                    plot(data)
                });
        
            function plot(data) {
                var svg = d3.select("#plot")
                .append("svg")
                .attr("id", "diamond")
                .attr("height", h)
                .attr("width", w);
              
                var xScale = d3.scaleLinear()
                .domain([minGini, maxGini])
                .range([pad, w - pad]);
            
                var yScale = d3.scaleLinear()
                .domain([minGini, maxGini])
                .range([h - pad, pad]);

                var xAxis = d3.axisBottom(xScale).ticks(8);
                var yAxis = d3.axisLeft(yScale).ticks(8);
                
            // functions to make gridlines on x and y axes
                function make_x_gridlines() {		
                    return d3.axisBottom(xScale)
                    .ticks(8)
                }
                function make_y_gridlines() {		
                    return d3.axisLeft(yScale)
                    .ticks(8)
                }

            // blue rectangle
                svg.append("rect")
                .attr("x", pad).attr("y", pad).attr("height", h - 2*pad).attr("width", w - 2*pad)
                .style("fill", '#eaf8fd');

            // zero line
                svg.append("line")
                .attr("class", "zero-line")
                .attr("x1", pad).attr("y1", h - pad).attr("x2", w - pad).attr("y2", pad);
                
            // key
                svg.append("rect")
                .attr("x", 1100)
                .attr("y", -300)
                .attr("width", 200)
                .attr("height", 200)
                .attr("transform", "rotate(45)")
                .style("fill", "black")
            
        // x and y axes, ticks, and labels
            svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", "translate(0," + (h - pad) + ")")
                .call(xAxis)
                .selectAll("text")  
                .style("text-anchor", "start")
                .attr("dx", 5)
                .attr("dy", 2)
                .attr("transform", 'rotate(45)')
                .attr('text-anchor','start');
            d3.select('.x-axis')
                .append('text')
                .attr("class", "axis-title")
                .attr("transform", "translate(" + (w/2 - pad) + ", 40)")
                .attr('fill','black')
                .attr('text-anchor','start')
                .text(function(d) {
                    return xYearGini;
                } );
            
            svg.append("g")
                .attr("class", "y-axis")
                .attr("transform", "translate(" + pad +", 0)")
                .call(yAxis)
                .selectAll("text")  
                .style("text-anchor", "end")
                .attr("dx", 5)
                .attr("dy", 10)
                .attr("transform", 'rotate(45)')
                .attr('text-anchor','end');
             d3.select('.y-axis')
                .append('text')
                .attr("class", "axis-title")
                .attr("transform", "rotate(90)")
                .attr('fill','black')
                .attr('text-anchor','end')
                .text(function(d) {
                    return yYearGini;
                } );
                
            // tick marks to x and y axes
                var xticks = svg.selectAll("xticks")
                .data(data)
                .enter()
                .append("line")
                .attr("class", "ticks")
                .attr("x1", function(d) {return xScale(d[xColumn]); })
                .attr("y1", h - pad)
                .attr("x2", function(d) {return xScale(d[xColumn]); })
                .attr("y2", h - pad - 10)
                
                var yticks = svg.selectAll("yticks")
                .data(data)
                .enter()
                .append("line")
                .attr("class", "ticks")
                .attr("x1", pad)
                .attr("y1", function(d) {return yScale(d[yColumn]); })
                .attr("x2", pad + 10)
                .attr("y2", function(d) {return yScale(d[yColumn]); })
            
              svg.append("g")			
                .attr("class", "grid")
                .attr("transform", "translate(0," + graphTop + ")")
                .call(make_x_gridlines()
                    .tickSize(-h + 2*pad)
                    .tickFormat("")
                )
                
                svg.append("g")			
                .attr("class", "grid")
                .attr("transform", "translate(" + pad + ",0)")
                .call(make_y_gridlines()
                    .tickSize(-h + 2*pad)
                    .tickFormat("")
                )
                
        // next sections are to make arrows
            svg.append("line")
            .attr("class", "arrow")
            .attr("x1", w*13/20).attr("y1", h*13/20).attr("x2", w*16/20).attr("y2", h*16/20);
            svg.append("line")
            .attr("class", "arrow")
            .attr("x1", w*16/20).attr("y1", h*16/20).attr("x2", w*16/20).attr("y2", h*15.5/20);
            svg.append("line")
            .attr("class", "arrow")
            .attr("x1", w*15.5/20).attr("y1", h*16/20).attr("x2", w*16/20).attr("y2", h*16/20);

            svg.append("line")
            .attr("class", "arrow")
            .attr("x1", w*4/20).attr("y1", h*4/20).attr("x2", w*7/20).attr("y2", h*7/20);
            svg.append("line")
            .attr("class", "arrow")
            .attr("x1", w*4/20).attr("y1", h*4/20).attr("x2", w*4/20).attr("y2", h*4.5/20);
            svg.append("line")
            .attr("class", "arrow")
            .attr("x1", w*4.5/20).attr("y1", h*4/20).attr("x2", w*4/20).attr("y2", h*4/20);
            
        // improved and worsened labels
                svg.append("text")
                .attr('class', "inequality")
                .attr("x", w*7/20).attr("y", h*8/20)
                .text("Inequality improved").style('fill', 555555).attr("transform", 'translate(220,-250) rotate(45)')
                // svg.append("text")
                // .attr('class', "inequality")
                // .attr("x", w*3.25/5).attr("y", pad*1.1).attr("dy", 10)
                // .text("improved").style('fill', 555555).attr("transform", 'translate(220,-250) rotate(45)')
                svg.append("text")
                .attr('class', "inequality")
                .attr("x", w*23.5/20).attr("y", h*8.5/20)
                .text("Inequality worsened").style('fill', 555555).attr("transform", 'translate(117,-380) rotate(45)')
                // svg.append("text")
                // .attr('class', "inequality")
                // .attr("x", w*1.005).attr("y", pad*1.3).attr("dy", 10)
                // .text("worsened").style('fill', 555555).attr("transform", 'translate(117,-380) rotate(45)')
        
            var circ = svg.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                .attr("class", "dot")
                .attr("data-toggle", "modal")
                .attr("data-target", "#myModal")
                .attr("cx", function(d) { return xScale(d[xColumn]); })
                .attr("cy", function(d) { return yScale(d[yColumn]); })
                .attr("r", radius)
                .attr("opacity", 0.8)
                .style("fill", "#4292c6")
                
                
            // var countries = svg.selectAll("text")
            //     .data(data)
            //     .append("text")
            //     .attr("class", "countries")
            //     .attr("cx", function(d) { return xScale(d[xColumn]); })
            //     .attr("cy", function(d) { return yScale(d[yColumn]); })
            //     .attr("r", radius)
            //     .attr("opacity", 0.8)
            //     .style("fill", "#4292c6")
            //     .text(function(d) { return countryName});
                
        
        d3.selectAll('.dot')
            .on('mouseover', function() {
                d3.select("svg")
                    .append('text')
                    .attr('class','country _temp label')
                    .html(d3.select(this).datum().countryName + " (" + d3.select(this).datum().difference.toFixed(1) + ")")
                    .attr('x',d3.select(this).attr('cx'))
                    .attr('y',d3.select(this).attr('cy'))
                    .attr("dx", 5)
                    .attr("dy", -5)
                    .attr("fill", "black")
                    .attr('visibility', 'visible')
                d3.select("svg")
                    .append('line')
                    .attr('class', 'hover-line _temp')
                    .attr('x1',d3.select(this).attr('cx'))
                    .attr('y1',d3.select(this).attr('cy') + radius)
                    .attr('x2',d3.select(this).attr('cx'))
                    .attr('y2',graphTop)
                d3.select("svg")
                    .append('line')
                    .attr('class', 'hover-line _temp')
                    .attr('x1',pad)
                    .attr('y1',d3.select(this).attr('cy'))
                    .attr('x2',d3.select(this).attr('cx') - radius)
                    .attr('y2',d3.select(this).attr('cy'))
            })
            .on('mouseout', function() {
                d3.selectAll('._temp').remove();
            })
            .on('click', function(e,d) {
                d3.select("svg")
                    var countryData =
                    [{value: +e._2016, year: 2016},{value: +e._2015, year: 2015},{value: +e._2014, year: 2014},{value: +e._2013, year: 2013},
                    {value: +e._2012, year: 2012},{value: +e._2011, year: 2011},{value: +e._2010, year: 2010},{value: +e._2009, year: 2009},
                    {value: +e._2008, year: 2008},{value: +e._2007, year: 2007},{value: +e._2006, year: 2006},{value: +e._2005, year: 2005},
                    {value: +e._2004, year: 2004},{value: +e._2003, year: 2003},{value: +e._2002, year: 2002},{value: +e._2001, year: 2001},
                    {value: +e._2000, year: 2000},{value: +e._1999, year: 1999},{value: +e._1998, year: 1998},{value: +e._1997, year: 1997},
                    {value: +e._1996, year: 1996},{value: +e._1995, year: 1995},{value: +e._1994, year: 1994},{value: +e._1993, year: 1993},
                    {value: +e._1992, year: 1992},{value: +e._1991, year: 1991},{value: +e._1990, year: 1990},{value: +e._1989, year: 1989},
                    {value: +e._1988, year: 1988},{value: +e._1987, year: 1987},{value: +e._1986, year: 1986},{value: +e._1985, year: 1985},
                    {value: +e._1984, year: 1984},{value: +e._1983, year: 1983},{value: +e._1982, year: 1982},{value: +e._1981, year: 1981},
                    {value: +e._1980, year: 1980}];
        
                    let modalTitle = d3.selectAll("h3.modal-title");
                    modalTitle.text("Gini scores in " + e.countryName);
                    let modalBody = d3.selectAll(".modal-body");
                    modalBody.html("<div id='countryPlot'></div>")
            
                    var pad = 30;
                    var w = 700;
                    var h = 200;
                    var graphTop = h - pad;
                    var radius = 7;
                    var minGini = 20;
                    var maxGini = 80;
            
                    var svg = d3.select("#countryPlot")
                    .append("svg")
                    .attr("height", h)
                    .attr("width", w);
              
                    var xScale = d3.scaleLinear()
                    .domain([1980, 2016])
                    .range([pad+10, w - pad]);
            
                    var yScale = d3.scaleLinear()
                    .domain([minGini, maxGini])
                    .range([h - pad, pad]);

                    var xAxisTickLabels = ["1980","","","","","1985","","","","","1990","","","","",
                    "1995","","","","","2000","","","","","2005",,"","","","","2010","","","","","2015",""]
                    var xAxis = d3.axisBottom(xScale).ticks(37).tickValues(d.year).tickFormat(function(d,i){ return xAxisTickLabels[i] });
                    var yAxis = d3.axisLeft(yScale).ticks(4);
                    
                    function make_y_gridlines() {		
                        return d3.axisLeft(yScale)
                        .ticks(8)
                    }
                    
                svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", "translate(0," + (h - pad) + ")")
                .call(xAxis)
                .selectAll("text")  
                .style("text-anchor", "start")
                .attr("transform", 'translate(-25, 20) rotate(-45)')
                .attr('text-anchor','start');
                d3.select('.x-axis')
                .append('text')
                .attr("class", "axis-title")
                .attr("transform", "translate(" + w/2 + ", 30)")
                .attr('fill','black')
                .attr('text-anchor','start')
                .text("Year");
            
                svg.append("g")
                .attr("class", "y-axis")
                .attr("transform", "translate(" + pad +", 0)")
                .call(yAxis)
                .selectAll("text")  
                .style("text-anchor", "end")
                .attr('text-anchor','end');
                d3.select('.y-axis')
                .append('text')
                .attr("class", "axis-title")
                .attr("transform", "translate (" + w/2 + "," + (pad + h/5) + "rotate(90))")
                .attr('fill','black')
                .attr('text-anchor','end')
                .text("Gini score");
                
                svg.append("g")			
                .attr("class", "grid")
                .attr("transform", "translate(" + pad + ",0)")
                .call(make_y_gridlines()
                    .tickSize(-h + 2*pad)
                    .tickFormat("")
                )
                
                var circ = svg.selectAll("circle")
                .data(countryData)
                .enter()
                .append("circle")
                .attr("class", "dot")
                .attr("cx", function(d) { return xScale(d.year); })
                .attr("cy", function(d) { return yScale(d.value); })
                .attr("r", radius)
                .attr("opacity", 0.8)
                .style("fill", "#4292c6");
                });
            }
        });

    </script>
    <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>
    
    </body>
</html>